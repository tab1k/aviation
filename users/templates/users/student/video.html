<!DOCTYPE html>
{% extends 'users/student/base.html' %}
{% load static %}
{% load embed_video_tags %}
<html lang="ru" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
  {% block css %}<link rel="stylesheet" type="text/css" href="{% static 'admin/css/videoAdmin.css' %}">{% endblock %}
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
</head>

<body>
  <div class="all_page">
    <!-- SIDE BAR-->

    <!-- -->
    {% block content %}
        <div class="content">

      <div class="back">
        <a href="coursesAfterSignUp.html"><b>–ö—É—Ä—Å—ã ‚û°Ô∏è </b></a><a href="module.html"><b>  –ú–æ–¥—É–ª–∏ ‚û°Ô∏è </b></a><a href="#"><b> {{ lesson.title }} </b></a>
      </div>

    <div class="buttons">
        {% if previous_lesson %}
            <button class="btn btn-primary prev" disabled><a href="{% url 'users:student:previous_lesson' lesson_id=previous_lesson.id %}" class="btn btn-primary" style="cursor: pointer">–ü—Ä–µ–¥—ã–¥—É—â–∏–π</a></button>
        {% else %}
            <button class="btn btn-primary prev" disabled>–ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
        {% endif %}
        {% if next_lesson %}
            <button class="btn btn-primary next" disabled><a href="{% url 'users:student:next_lesson' lesson_id=next_lesson.id %}" class="btn btn-primary" style="cursor: pointer">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫</a></button>
        {% else %}
            <button class="btn btn-primary next" disabled>–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫</button>
        {% endif %}
    </div>

      <!-- my courses -->

      <div class="courses">

        <!-- video -->

        <div class="video">

          <!-- theme lesson -->

          <div class="theme">

            <p>{{ lesson.title }}</p>
            <p>{{ lesson.description }}</p>
            {% if lesson.learn_documentation %}
                <p>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: <a style="color: black" href="{{ lesson.learn_documentation.url }}" target="_blank">{{ lesson.learn_documentation.url|truncatechars:10 }} üìé</a></p>
            {% endif %}

          </div>

          <!-- .video_course -->

          <style>
            .video-wrapper {
                position: relative;
                padding-bottom: 56.25%; /* 16:9 aspect ratio (800 / 450 * 100) */
                height: 0;

            }

            .video-wrapper iframe {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border-radius: 10px;
            }

            .buttonNext {
                position: relative; /* Make the button container relative to enable z-index */
                z-index: 1; /* Ensure the button appears on top of the video */
            }
        </style>

        <div class="video_course">
            <div class="video-wrapper">
                {% video lesson.video width="800" height="450" %}  {# Adjust width and height as needed #}
            </div>

            <div class="buttonNext">
                {% if lesson.test_set.exists %}
                    <button><a href="{% url 'users:admin:courses:tests:take_test' lesson_id=lesson.id%}">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</a></button>
                {% elif lesson.essay_set.exists %}
                    <button class="essay"><a style="color: white" href="{% url 'users:student:courses:essays:essay_submission'  lesson_id=lesson.id%}">–°–¥–∞—Ç—å —ç—Å—Å–µ</a></button>
                {% endif %}
            </div>

        </div>







          <!-- chat -->

          <div class="chat">
                <div class="comments">
                    {% for comment in comments %}
                    {% if comment.is_student_comment %}
                    <div class="comment">
                        <!-- –í–∞—à –∫–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                        <div class="comment-text">
                            <p><strong>{{ comment.user }}</strong>(student): {{ comment.text }}</p>
                        </div>
                    </div>
                    {% else %}
                    <!-- –ö–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫—É—Ä–∞—Ç–æ—Ä–∞ -->
                    {% endif %}
                    {% endfor %}
                </div>
                <div class="reply">
                    <form method="post" id="commentForm">
                        {% csrf_token %}
                        <input type="text" name="text" class="reply-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏">
                        <button type="submit" class="send"><img src="{% static 'student/img/send.svg' %}" alt=""></button>
                    </form>
                </div>
            </div>

        </div>

      </div>

    </div>
        </div>
        <script>
        document.getElementById('commentForm').addEventListener('submit', function(event) {
            event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            const form = event.target;
            const formData = new FormData(form);

            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken') // –ü–µ—Ä–µ–¥–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
                }
            })
            .then(response => response.json()) // –û–∂–∏–¥–∞–µ–º JSON-–æ—Ç–≤–µ—Ç
            .then(data => {
                if (data.success) {
                    form.reset(); // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                    const commentsDiv = document.querySelector('.comments');
                    commentsDiv.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                    for (const comment of data.comments) {
                        const commentDiv = document.createElement('div');
                        commentDiv.className = 'comment';
                        commentDiv.innerHTML = `
                            <div class="ava">
                                <img src="{% static 'student/img/comment-ava.jpg' %}" alt="">
                            </div>
                            <div class="comment-text">
                                <p><strong>Student: ${comment.user}</strong>: ${comment.text}</p>
                            </div>`;
                        commentsDiv.appendChild(commentDiv);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>

    {% endblock %}

    <script src="{% static 'admin/js/side-bar.js' %}"></script>

</body>

</html>