{% extends 'users/admin/base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="ru" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap">
  {% block css %}
      <link rel="stylesheet" type="text/css" href="{% static 'admin/css/student.css' %}" rel="stylesheet">
      <link rel="stylesheet" type="text/css" href="{% static 'admin/css/progress_adaptive.css' %}" rel="stylesheet">
  {% endblock %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
</head>

<body>

    {% block content %}
        <div class="content">

      <!-- search-input -->

      <div class="content-header">
        <h2>Успеваемость студента {{ student.first_name }}</h2>


        <form method="GET" action="{% url 'stransit:users:admin:search_curators' %}">

          <div class="search-footer">
            <input type="text" name="q"  placeholder="Поиск...">
            <button>Поиск</button>
          </div>


        </form>
      </div>


      <!-- Главная -->
            <main class="table-responsive">
              <table id="progress-table">
                  <thead style="display: contents">
                    <tr>
                      <th>Курс</th>
                      <th>Модуль</th>
                      <th>Урок</th>
                      <th>Результат теста</th>
                      <th>Сдано эссе</th>
                      <th>Студент успешно завершил</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in progress %}
                    <tr>
                      <td>{{ item.course.title }}</td>
                      <td>{{ item.module.title }}</td>
                      <td>{{ item.lesson.title }}</td>
                      <td>{{ item.test_result.score }}</td>
                      <td>{% if item.essay_submission %}Да{% else %}Нет{% endif %}</td>
                      <td>{% if item.is_completed %}Да{% else %}Нет{% endif %}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
            </main>

            <div style="padding: 3%;">
                <h2>Общая статистика</h2>
              <p>Средний балл за тесты: {{ average_test_score }}</p>
              <p>Количество сданных эссе: {{ total_essays_submitted }}</p>

              <!-- Charts -->
              <h2>Графики</h2>
              <div style="width: 100%; max-width: 500px;">
                <canvas id="testScoresChart"></canvas>
              </div>
              <div style="width: 100%; max-width: 500px;">
                <canvas id="essaySubmissionsChart"></canvas>
              </div>

            </div>





        </div>
    {% endblock %}

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var testScoresChart = new Chart(testScoresCtx, {
  type: 'bar',
  data: {
    labels: {% autoescape off %}{{ lessons_titles|safe }}{% endautoescape %},
    datasets: [{
      label: 'Баллы за тесты',
      data: {% autoescape off %}{{ test_scores|safe }}{% endautoescape %},
      backgroundColor: 'rgba(54, 162, 235, 0.8)',
    }],
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        ticks: {
          font: {
            size: 14,
          },
        },
      },
      y: {
        ticks: {
          font: {
            size: 14,
          },
        },
      },
    },
  },
});

var essaySubmissionsChart = new Chart(essaySubmissionsCtx, {
  type: 'line', // Change the chart type to line
  data: {
    labels: {% autoescape off %}{{ lessons_titles|safe }}{% endautoescape %},
    datasets: [{
      label: 'Изменение эссе',
      data: {% autoescape off %}{{ essays_submitted|safe }}{% endautoescape %},
      fill: false, // Do not fill the area under the line
      borderColor: 'rgba(255, 99, 132, 0.8)',
      borderWidth: 2,
    }],
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        ticks: {
          font: {
            size: 14,
          },
        },
      },
      y: {
        ticks: {
          font: {
            size: 14,
          },
        },
      },
    },
  },
});

</script>

<script>
  $(document).ready(function() {
    // Создаем ползунок
    $("#slider").slider({
      range: true,
      min: 0,
      max: 100,
      values: [0, 100],
      slide: function(event, ui) {
        // При перемещении ползунка обновляем данные в таблице
        $("#progress-table tbody tr").each(function() {
          var testScore = parseInt($(this).find("td:eq(3)").text());
          var essaySubmission = $(this).find("td:eq(4)").text() === "Да";
          var isCompleted = $(this).find("td:eq(5)").text() === "Да";

          if (testScore >= ui.values[0] &&
              testScore <= ui.values[1] &&
              (essaySubmission || !ui.values[2]) &&
              (isCompleted || !ui.values[3])) {
            $(this).show();
          } else {
            $(this).hide();
          }
        });
      }
    });
  });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
</html>
